from langchain.chains import RetrievalQA
from langchain.text_splitter import CharacterTextSplitter
from langchain.vectorstores import FAISS
from langchain.embeddings.openai import OpenAIEmbeddings
from langchain.llms import OpenAI

# 1. Читаем текст
with open("document.txt", "r", encoding="utf-8") as f:
    text = f.read()

# 2. Разбиваем текст на фрагменты
text_splitter = CharacterTextSplitter(chunk_size=500, chunk_overlap=50)
chunks = text_splitter.split_text(text)

# 3. Создаем векторное хранилище
embeddings = OpenAIEmbeddings()
vectorstore = FAISS.from_texts(chunks, embeddings)

# 4. Создаем цепочку QA
qa_chain = RetrievalQA.from_chain_type(
    llm=OpenAI(temperature=0),
    retriever=vectorstore.as_retriever()
)

# 5. Задаем вопрос
question = "О чем этот документ?"
answer = qa_chain.run(question)
print(answer)
